# Circuit Simulator

A comprehensive analog circuit simulator built with SvelteFlow, shadcn-svelte, and Tailwind CSS.

## Features

### 🎛️ Component Library
- **Passive Components**: Resistors, Capacitors, Inductors
- **Sources**: Voltage Sources, Current Sources, Ground
- **Semiconductors**: Diodes, Transistors (NPN/PNP), Op-Amps
- **Measurement**: Voltmeters, Ammeters, Test Probes

### 🎯 User Interface
- **Drag & Drop**: Drag components from sidebar to canvas or click to add at center
- **3-Panel Layout**: Components sidebar, main canvas, properties sidebar
- **Search Functionality**: Filter components by name or description
- **Visual Feedback**: Hover effects, selection highlighting, themed component colors

### ⚡ Circuit Features
- **Visual Circuit Building**: Connect components with wires using handles
- **Component Properties**: Edit parameters for each component (resistance, voltage, etc.)
- **Netlist Export**: Export circuits in SPICE-compatible netlist format
- **JSON Export**: Save circuit data in structured JSON format
- **Demo Circuits**: Load pre-built example circuits

### 🎨 Component Styling
Each component type has its own visual theme:
- **Resistors**: Red theme with zigzag symbol
- **Capacitors**: Blue theme with parallel plates
- **Inductors**: Green theme with coil symbol
- **Voltage Sources**: Orange theme with +/- symbols
- **Op-Amps**: Gray theme with triangle amplifier symbol
- **Ground**: Gray theme with ground symbol

### 🔌 Connection System
- **Smart Handles**: Components have appropriate input/output connection points
- **Visual Wires**: Connections are drawn as styled SVG paths
- **Connection Validation**: Proper source-to-target connections

### 📊 Analysis & Export
- **Netlist Generation**: Automatic conversion to SPICE format
- **Component Counting**: Track all components and connections
- **Circuit Validation**: Basic circuit topology checking
- **File Export**: Download netlists and JSON circuit files

### 🤝 Real-time Collaboration
- **YJS Integration**: Real-time collaborative editing using YJS protocol
- **Live Cursors**: See other users' cursors and actions in real-time
- **Instant Sync**: Changes are synchronized immediately across all connected users
- **Room-based Isolation**: Each project has its own collaboration room
- **Direct Array Manipulation**: No complex state management - direct array updates

## Usage

1. **Adding Components**:
   - Drag components from the left sidebar to the canvas
   - Or click a component to add it at the center

2. **Connecting Components**:
   - Drag from one component's handle to another to create connections
   - Handles are color-coded by component type

3. **Editing Properties**:
   - Click a component to select it
   - Edit parameters in the right sidebar

4. **Export Options**:
   - Use "Export Netlist" to get SPICE-compatible circuit description
   - Use "Export JSON" to save the complete circuit data

5. **Demo Circuit**:
   - Click "Load Demo Circuit" to see an example amplifier circuit

## Technical Details

### Architecture
- **Direct Array Manipulation**: Uses Svelte's `$state` for local state management
- **Callback-based Collaboration**: YJS collaboration uses callback functions for updates
- **No Central Store**: Removed circuit store in favor of simpler local state
- **Database Integration**: Supabase for persistence, YJS for real-time collaboration

### Component Data Structure
```typescript
interface CircuitComponent {
  id: string;
  type: string;
  parameters: ComponentParameters;
  position: { x: number; y: number };
  connections: { [portName: string]: string[] };
}
```

### Collaboration System
```typescript
interface CollaborationCallbacks {
  onNodeUpdate?: (nodeId: string, nodeData: any) => void;
  onNodeAdd?: (nodeId: string, nodeData: any) => void;
  onNodeRemove?: (nodeId: string) => void;
  onEdgeUpdate?: (edgeId: string, edgeData: any) => void;
  onEdgeAdd?: (edgeId: string, edgeData: any) => void;
  onEdgeRemove?: (edgeId: string) => void;
  onStateLoad?: (nodes: any[], edges: any[]) => void;
}
```

### Netlist Format
The simulator exports standard SPICE netlists:
```
* Circuit Netlist Generated by Saffron Circuit Simulator
R1 n1_R1 n2_R1 1k
C1 n1_C1 n2_C1 1u
V1 n1_V1 n2_V1 5V
.end
```

### JSON Circuit Data
Circuits are stored in a structured format compatible with netlist parsing:
```json
{
  "modules": {
    "main": {
      "ports": {},
      "cells": {
        "component_id": {
          "type": "resistor",
          "parameters": { "resistance": "1k" },
          "connections": { "port1": ["net1"], "port2": ["net2"] }
        }
      }
    }
  }
}
```

## Development

The simulator is built with:
- **SvelteFlow**: For the interactive canvas and node system
- **shadcn-svelte**: For UI components and consistent styling
- **Tailwind CSS**: For responsive design and theming
- **TypeScript**: For type safety and better development experience

### File Structure
```
routes/editor/
├── +page.svelte              # Main simulator page
├── components/
│   ├── ComponentsSidebar.svelte    # Left component panel
│   ├── PropertiesSidebar.svelte    # Right properties panel
│   ├── ComponentIcon.svelte        # SVG icons for components
│   ├── nodes/                      # Individual component nodes
│   │   ├── ResistorNode.svelte
│   │   ├── CapacitorNode.svelte
│   │   ├── OpAmpNode.svelte
│   │   └── ...
│   └── edges/
│       └── WireEdge.svelte         # Connection visualization
└── stores/
    └── circuit-store.ts            # State management
```

## Future Enhancements

- [ ] Real circuit simulation (DC, AC, Transient analysis)
- [ ] Component value validation and unit conversion
- [ ] Dark mode support
- [ ] Circuit sharing and collaboration
- [ ] Advanced component models
- [ ] Schematic printing and PDF export
- [ ] Component libraries and custom components
- [ ] Undo/Redo functionality
